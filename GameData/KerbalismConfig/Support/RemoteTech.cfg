// Support for RemoteTech


// Kerbalism's Communotron 8
@PART[kerbalism-antenna]:NEEDS[RemoteTech]:AFTER[RemoteTech]
{
	!MODULE[ModuleDataTransmitter],* {}
	!MODULE[ModuleDeployableAntenna],* {}
	!MODULE[Reliability],* {}

	%MODULE[ModuleAnimateGeneric]
	{
		%animationName = antenna
		%isOneShot = false
	   
		%startEventGUIName = Extend
		%endEventGUIName = Retract
		%actionGUIName = Toggle Antenna
		%allowManualControl = false
		%actionAvailable = false
		%eventAvailableFlight = false
		%eventAvailableEditor = false
		%eventAvailableEVA = false
	}

	%MODULE[ModuleRTAntenna]
	{
		%Mode0OmniRange = 0
		%Mode1OmniRange = 1750000
		%EnergyCost = 0.04
		%MaxQ = 3000

		%TRANSMITTER
		{
			%PacketInterval = 1.0
			%PacketSize = 0.0024		// Max. speed: 2.4 kB/s
			%PacketResourceCost = 8
		}
	}

	%MODULE[ModuleSPUPassive] {}
}

@PART[RTShort*]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 1.2
		extra_mass = 0.1
	}	
}

@PART[RTLong*]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 1.5
		extra_mass = 0.4
	}	
}

@PART[RTGiga*]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 3.2
		extra_mass = 0.5
	}	
}

// generic patches

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[PlannerController]:HAS[#title[transmitter]]]:NEEDS[RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = PlannerController
		title = transmitter
		considered = true
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[>0]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 0.05
		extra_mass = 0.001
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[>0]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000
		extra_cost = 0.05
		extra_mass = 0.001
	}
}

// ============================================================================
// Adjust RemoteTech data transmission rates and energy consumption
// ============================================================================

// Try find all antennas that has RemoteTech module and tweak values to better fit Kerbalism balance
// with transmission rates and energy consumption.
// NOTE: This tweak is for all modules that has NOT been explicitly balanced in the entries
// following this one, below. That is typically antennas found in third-party mods that has
// RemoteTech configs
//
// TLDR: quick fix for all antennas in third-party mods using RemoteTech that we didn't consider.

@PART[*]:HAS[@MODULE[ModuleRTAntenna]]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech]
{
	@MODULE[ModuleRTAntenna]
	{
		@TRANSMITTER
		{
			@PacketInterval = 1
			@PacketSize /= 40
		}
	}
}

// Reflectron DP-10
@PART[RTShortAntenna1]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.0012	// Max. speed: 1.1 kB/s
			@PacketResourceCost = 6
		}
	} 
}

// Communotron 16-S
@PART[SurfAntenna]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.0022	// Max. speed: 2.2 kB/s
			@PacketResourceCost = 8
		}
	} 
}

// Kerbalism's Communotron 8
@PART[kerbalism-antenna]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.0026		// Max. speed: 2.4 kB/s
			@PacketResourceCost = 8
		}
	} 
}

// Communotron 16
@PART[longAntenna]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.0032		// Max. speed: 3.2 kB/s
			@PacketResourceCost = 10
		}
	} 
}

// CommTech EXP-VR-2T
@PART[RTLongAntenna3]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.0044	// Max. speed: 4.4 kB/s
			@PacketResourceCost = 12
		}
	} 
}

// Communotron 32
@PART[RTLongAntenna2]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.0122	// Max. speed: 12.2 kB/s
			@PacketResourceCost = 14
		}
	} 
}

// HG-5 High Gain Antenna 
@PART[HighGainAntenna5_v2]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.0054	// Max. speed: 5.4 kB/s
			@PacketResourceCost = 12
		}
	} 
}

// Communotron DTS-M1 
@PART[mediumDishAntenna]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.049		// Max. speed: 49 kB/s	
			@PacketResourceCost = 14
		}
	} 
}

// Reflectron KR-7
@PART[RTShortDish2]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.055		// Max. speed: 55 kB/s	
			@PacketResourceCost = 15
		}
	} 
}

// RA-2 Relay Antenna
@PART[RelayAntenna5]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.0653	// Max. speed: 65.3 kB/s
			@PacketResourceCost = 16
		}
	} 
}

// RA-15 Relay Antenna
@PART[RelayAntenna50]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.1507	// Max. speed: 150.7 kB/s
			@PacketResourceCost = 16
		}
	} 
}

// Communotron HG-55
@PART[HighGainAntenna]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.2535	// Max. speed: 253.5 kB/s
			@PacketResourceCost = 18
		}
	} 
}

// Communotron 88-88
@PART[commDish]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.4417	// Max. speed: 441.7 kB/s
			@PacketResourceCost = 20
		}
	} 
}

// Reflectron KR-14
@PART[RTLongDish2]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.4815	// Max. speed: 481.5 kB/s
			@PacketResourceCost = 22
		}
	} 
}

// RA-100 Relay Antenna
@PART[RelayAntenna100]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.5571	// Max. speed: 557.1 kB/s
			@PacketResourceCost = 24
		}
	} 
}

// CommTech-1
@PART[RTGigaDish2]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.7843	// Max. speed: 784.3 kB/s
			@PacketResourceCost = 24
		}
	} 
}

// Reflectron GX-128
@PART[RTGigaDish1]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech] 
{ 
	@MODULE[ModuleRTAntenna] 
	{ 
		@TRANSMITTER
		{
			@PacketSize = 0.8204	// Max. speed: 820.4 kB/s
			@PacketResourceCost = 26
		}
	} 
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna]]:NEEDS[RemoteTech,FeatureScience]:AFTER[RemoteTech]
{
	MODULE
	{
		name = AntennaDataTransmitterRemoteTech
	}
}